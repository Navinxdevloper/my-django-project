
{% block content %}
  <h1 class="chat-header">Chat with {{ receiver }}</h1>

  <div id="chat-messages" class="chat-messages">
    {% for message in messages %}
      <div class="message">
        <strong class="sender">{{ message.sender.username }}:</strong> {{ message.content }}
      </div>
    {% endfor %}
  </div>

  <div class="message-input-container">
    <textarea id="message-input" class="message-input" placeholder="Type a message..."></textarea>
    <button id="send-message" class="send-button">Send</button>
  </div>
{% endblock %}

<!-- Styling with animations and colors -->
<style>
  body {
    font-family: 'Arial', sans-serif;
    background-color: #f7f9fc;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }

  .chat-header {
    font-size: 24px;
    color: #3c4b6c;
    margin-bottom: 20px;
    text-align: center;
  }

  .chat-messages {
    width: 100%;
    max-width: 600px;
    height: 400px;
    overflow-y: scroll;
    margin-bottom: 20px;
    padding: 10px;
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    animation: fadeIn 0.5s ease-out;
  }

  .message {
    margin: 10px 0;
    padding: 8px;
    border-radius: 5px;
    background-color: #e5e5e5;
    color: #333;
    animation: slideIn 0.3s ease-out;
  }

  .sender {
    font-weight: bold;
    color: #3c4b6c;
  }

  .message-input-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 600px;
  }

  .message-input {
    width: 100%;
    height: 50px;
    padding: 10px;
    border-radius: 10px;
    border: 2px solid #ddd;
    margin-bottom: 15px;
    font-size: 16px;
    outline: none;
    resize: none;
    transition: border-color 0.3s;
  }

  .message-input:focus {
    border-color: #3c4b6c;
  }

  .send-button {
    padding: 10px 20px;
    background-color: #3c4b6c;
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .send-button:hover {
    background-color: #2c3e56;
    transform: scale(1.1);
  }

  .send-button:active {
    transform: scale(1);
  }

  /* Animations */
  @keyframes fadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
  }

  @keyframes slideIn {
    0% { transform: translateX(-30px); opacity: 0; }
    100% { transform: translateX(0); opacity: 1; }
  }

  /* Smooth scroll */
  .chat-messages {
    scroll-behavior: smooth;
  }
</style>

<script>
  // Open WebSocket connection
  const chatSocket = new WebSocket(
    `wss://${window.location.host}/ws/chat/{{ receiver }}/`

  );
  chatSocket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    const message = data['message'];
    const sender = data['sender'];

    // नया मैसेज दिखाने के लिए डिव बनाएं
    const messageContainer = document.createElement('div');
    messageContainer.classList.add('message');
    messageContainer.innerHTML = `<strong class="sender">${sender}:</strong> ${message}`;

    document.querySelector('#chat-messages').appendChild(messageContainer);
    document.querySelector('#chat-messages').scrollTop = document.querySelector('#chat-messages').scrollHeight;
};

// मैसेज भेजने के लिए कोड
document.querySelector('#send-message').onclick = function(e) {
    const messageInputDom = document.querySelector('#message-input');
    const message = messageInputDom.value.trim();

    if (message !== '') {
        chatSocket.send(JSON.stringify({
            'message': message,
            'sender': '{{ request.user.username }}'
        }));
        messageInputDom.value = '';  // मैसेज भेजने के बाद इनपुट क्लियर करें
    }
};

</script>
